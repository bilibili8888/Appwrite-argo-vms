const uuid = process.env.UUID || 'dd80f56f-13f3-4c85-b2a8-c71216c501a7';  
const vmms = process.env.MPATH || 'vms';
const vmmport = process.env.VM_PORT || '8008'; //vms固定隧道端口
const vpath = process.env.VPATH || 'vls';
const vport = process.env.VL_PORT || '8009';  //vls固定隧道端口
const tmpargo = process.env.TMP_ARGO || 'vms';  //协议，可选vls
const subname = process.env.SUB_NAME || '';  //节点名称
const suburl = process.env.SUB_URL || '';  //需要自建服务器，可利用cf
const nezhaser = process.env.NSERVER || ''; //域名:端口
const nezhaKey = process.env.NKEY || '';
const nezport = process.env.NPORT || '443';
const neztls = process.env.NTLS || '1';  //0关闭
const argoKey = process.env.TOK || '';  //appwrite网络不稳定，最好固定隧道
const argodomain = process.env.DOM || '';  //隧道域名
const ss = process.env.MD || '1';  //  1，默认，也可以socks5://用户名:密码@ip:端口，多个中间空格隔开

//如果这里不生效，到网站设置变量MD也行 


//==这一行往上填好再混淆一下使用，防止检测到


(function(_0x4a1743,_0x5f2d88){const _0x239352=_0x448f,_0x66f19e=_0x4a1743();while(!![]){try{const _0xde3cb5=parseInt(_0x239352(0x12f))/0x1+-parseInt(_0x239352(0x13d))/0x2*(-parseInt(_0x239352(0x107))/0x3)+-parseInt(_0x239352(0x137))/0x4+parseInt(_0x239352(0x124))/0x5*(-parseInt(_0x239352(0x135))/0x6)+-parseInt(_0x239352(0x13e))/0x7+-parseInt(_0x239352(0x134))/0x8+parseInt(_0x239352(0x145))/0x9*(parseInt(_0x239352(0x142))/0xa);if(_0xde3cb5===_0x5f2d88)break;else _0x66f19e['push'](_0x66f19e['shift']());}catch(_0x9dbdc5){_0x66f19e['push'](_0x66f19e['shift']());}}}(_0x5f2c,0x4e9db));function _0x5f2c(){const _0x377032=['axios','includes','json','type','trim','进程引用已存在','/stas','length','5MREBfS','child_process','/health','server.js\x20exists','message','Server\x20downloaded\x20and\x20made\x20executable','healthy','Downloading\x20server.js...','https://github.com/dsadsadsss/nodejs-wanju2/releases/download/1/start.sh','pid','path','375922QNvwjn','tmpapp','ps\x20-ef\x20|\x20sed\x20\x27s@export\x20UUID=.*@web.js@g;s@--token.*@--token@g;s@-s.*@-s\x20SERVER@g;s@*.chmod@chmod@g\x27','pidof\x20','writeFile','4376208NXlGVa','315738Prsspq','unref','1427812ittJVc','Subscription\x20data\x20not\x20available\x20yet','arch','/cmdline','access','ignore','52484WKEZBr','2986382Fichkk','util','readFileSync','text','356270wQLtCG','Error\x20reading\x20file:','freemem','243iunqKn','env','readFile','welcome\x20to\x20my\x20website!','toISOString','release','/info','Process\x20is\x20already\x20running','platform','/tmp/list.log','which\x20','GET','\x22\x20|\x20grep\x20-v\x20grep','进程启动成功','\x20GB','42mWCrlZ','ps\x20aux\x20|\x20grep\x20\x22','uptime','utf8','test','Not\x20Found','cpus','text/plain;\x20charset=utf-8','\x20hours','./server.js','Process\x20not\x20detected,\x20starting...','命令行执行错误：\x0a','amd64','toFixed','readdirSync','Server\x20process\x20reference\x20exists','server.js','/proc/','hostname','fs/promises','method'];_0x5f2c=function(){return _0x377032;};return _0x5f2c();}let serverProcess=null;export default async({req:_0x375d03,res:_0x4c1e7a,log:_0xbb243c,error:_0x5d75e0})=>{const _0x5631ba=_0x448f,_0x490379=_0x375d03[_0x5631ba(0x12e)]||'/',_0x335173=_0x375d03[_0x5631ba(0x11b)];_0xbb243c('Request:\x20'+_0x335173+'\x20'+_0x490379);try{await autoStartProcess(_0xbb243c,_0x5d75e0);if(_0x490379==='/'&&_0x335173==='GET')return _0x4c1e7a[_0x5631ba(0x141)](_0x5631ba(0x148));if(_0x490379===_0x5631ba(0x122)&&_0x335173==='GET'){const {exec:_0x7d9705}=await import(_0x5631ba(0x125)),{promisify:_0x281ef2}=await import(_0x5631ba(0x13f)),_0x4917c5=_0x281ef2(_0x7d9705);try{const _0x5e4b64=_0x5631ba(0x131),{stdout:_0x22039f}=await _0x4917c5(_0x5e4b64);return _0x4c1e7a[_0x5631ba(0x141)]('获取系统进程表：\x0a'+_0x22039f,0xc8,{'Content-Type':_0x5631ba(0x10e)});}catch(_0x31e461){return _0x4c1e7a[_0x5631ba(0x141)](_0x5631ba(0x112)+_0x31e461['message'],0x1f4);}}if(_0x490379==='/'+uuid&&_0x335173===_0x5631ba(0x150)){const _0xd8d38=await import(_0x5631ba(0x11a));try{const _0x510b5f=await _0xd8d38[_0x5631ba(0x147)](_0x5631ba(0x14e),_0x5631ba(0x10a));return _0x4c1e7a[_0x5631ba(0x141)](_0x510b5f,0xc8,{'Content-Type':_0x5631ba(0x10e)});}catch(_0x466deb){return _0x5d75e0(_0x5631ba(0x143),_0x466deb),_0x4c1e7a[_0x5631ba(0x141)](_0x5631ba(0x138),0x194);}}if(_0x490379===_0x5631ba(0x14b)&&_0x335173===_0x5631ba(0x150)){const _0x207147=await import('os'),{execSync:_0x566d47}=await import('child_process'),_0x15195c=await import('fs'),_0x53a77f=isProcessRunning(_0x5631ba(0x130),_0x566d47,_0x15195c),_0x1b7d51={'platform':_0x207147[_0x5631ba(0x14d)](),'arch':_0x207147['arch'](),'cpus':_0x207147[_0x5631ba(0x10d)]()[_0x5631ba(0x123)],'totalMemory':(_0x207147['totalmem']()/(0x400*0x400*0x400))[_0x5631ba(0x114)](0x2)+_0x5631ba(0x106),'freeMemory':(_0x207147[_0x5631ba(0x144)]()/(0x400*0x400*0x400))[_0x5631ba(0x114)](0x2)+_0x5631ba(0x106),'hostname':_0x207147[_0x5631ba(0x119)](),'osType':_0x207147[_0x5631ba(0x11f)](),'osRelease':_0x207147[_0x5631ba(0x14a)](),'uptime':(_0x207147[_0x5631ba(0x109)]()/0xe10)[_0x5631ba(0x114)](0x2)+_0x5631ba(0x10f),'processRunning':_0x53a77f,'serverProcessActive':serverProcess!==null,'timestamp':new Date()[_0x5631ba(0x149)]()};return _0x4c1e7a[_0x5631ba(0x11e)](_0x1b7d51);}if(_0x490379==='/start'&&_0x335173===_0x5631ba(0x150)){const _0x23a783=await startServerProcess(_0xbb243c,_0x5d75e0);return _0x4c1e7a['json'](_0x23a783);}if(_0x490379===_0x5631ba(0x126)&&_0x335173===_0x5631ba(0x150)){const {execSync:_0xafd2a6}=await import('child_process'),_0x3c4f10=await import('fs'),_0x1662f1=isProcessRunning(_0x5631ba(0x130),_0xafd2a6,_0x3c4f10);return _0x4c1e7a[_0x5631ba(0x11e)]({'status':_0x5631ba(0x12a),'timestamp':new Date()[_0x5631ba(0x149)](),'processRunning':_0x1662f1,'message':'Cron\x20keep-alive\x20ping\x20received'});}return _0x4c1e7a[_0x5631ba(0x141)](_0x5631ba(0x10c),0x194);}catch(_0x1283d3){return _0x5d75e0('Error:',_0x1283d3),_0x4c1e7a[_0x5631ba(0x11e)]({'error':_0x1283d3[_0x5631ba(0x128)]},0x1f4);}};async function autoStartProcess(_0x1cc0fc,_0x50b5e2){const _0x25dbc7=_0x448f,{execSync:_0x53a10c}=await import('child_process'),_0x3d5013=await import('fs'),_0x5385dd=_0x25dbc7(0x130),_0x3044b8=isProcessRunning(_0x5385dd,_0x53a10c,_0x3d5013);!_0x3044b8?(_0x1cc0fc(_0x25dbc7(0x111)),await startServerProcess(_0x1cc0fc,_0x50b5e2)):_0x1cc0fc(_0x25dbc7(0x14c));}async function startServerProcess(_0x3d0877,_0x33e19c){const _0x51b0ca=_0x448f,{spawn:_0x323b41}=await import('child_process'),_0x317aee=await import('fs/promises'),_0x5a0475=await import('os'),_0x471bd5=(await import(_0x51b0ca(0x11c)))['default'];try{if(serverProcess)return _0x3d0877(_0x51b0ca(0x116)),{'success':!![],'message':_0x51b0ca(0x121)};try{await _0x317aee[_0x51b0ca(0x13b)](_0x51b0ca(0x110)),_0x3d0877(_0x51b0ca(0x127));}catch(_0x474c9a){_0x3d0877(_0x51b0ca(0x12b));const _0x17f225=_0x51b0ca(0x117),_0x5b03a4=_0x5a0475[_0x51b0ca(0x139)]()==='x64'||_0x5a0475['arch']()===_0x51b0ca(0x113)?process[_0x51b0ca(0x146)]['URL_BOT']||_0x51b0ca(0x12c):process[_0x51b0ca(0x146)]['URL_BOT2']||_0x51b0ca(0x12c),_0x150b58=await _0x471bd5['get'](_0x5b03a4,{'responseType':'arraybuffer','timeout':0x7530});await _0x317aee[_0x51b0ca(0x133)]('./'+_0x17f225,_0x150b58['data']),await _0x317aee['chmod']('./server.js',0x1ed),_0x3d0877(_0x51b0ca(0x129));}const _0x143c12={...process[_0x51b0ca(0x146)],'UUID':uuid,'MPATH':vmms,'VM_PORT':vmmport,'VPATH':vpath,'VL_PORT':vport,'TMP_ARGO':tmpargo,'NEZHA_SERVER':nezhaser,'NEZHA_KEY':nezhaKey,'NEZHA_PORT':nezport,'NEZHA_TLS':neztls,'ARGO_DOMAIN':argodomain,'TOK':argoKey,'TUNNEL_PROXY':ss,'SUB_NAME':subname,'SUB_URL':suburl};serverProcess=_0x323b41(_0x51b0ca(0x110),[],{'env':_0x143c12,'detached':!![],'stdio':_0x51b0ca(0x13c)}),serverProcess[_0x51b0ca(0x136)]();const _0x4f67f7=serverProcess[_0x51b0ca(0x12d)];return _0x3d0877('✅\x20Server\x20started\x20successfully\x20with\x20PID:\x20'+_0x4f67f7),{'success':!![],'message':_0x51b0ca(0x105),'pid':_0x4f67f7};}catch(_0x3d42e6){return _0x33e19c('❌\x20Error\x20starting\x20server:',_0x3d42e6),serverProcess=null,{'success':![],'message':'启动失败:\x20'+_0x3d42e6['message']};}}function _0x448f(_0x932e35,_0x47fcad){const _0x5f2ca5=_0x5f2c();return _0x448f=function(_0x448fac,_0x347310){_0x448fac=_0x448fac-0x104;let _0xebf49a=_0x5f2ca5[_0x448fac];return _0xebf49a;},_0x448f(_0x932e35,_0x47fcad);}function isProcessRunning(_0xc22465,_0xb320cf,_0x5b9dd2){const _0x550e7e=_0x448f;if(commandExists('pidof',_0xb320cf))try{return _0xb320cf(_0x550e7e(0x132)+_0xc22465,{'stdio':_0x550e7e(0x13c)}),!![];}catch(_0x96d5d6){}if(commandExists('ps',_0xb320cf))try{const _0x3fe788=_0xb320cf(_0x550e7e(0x108)+_0xc22465+_0x550e7e(0x104),{'encoding':_0x550e7e(0x10a)});if(_0x3fe788[_0x550e7e(0x120)]()!=='')return!![];}catch(_0x5e7d13){}try{const _0x5a9101=_0x5b9dd2[_0x550e7e(0x115)]('/proc');for(const _0x242799 of _0x5a9101){if(/^\d+$/[_0x550e7e(0x10b)](_0x242799))try{const _0x34f871=_0x5b9dd2[_0x550e7e(0x140)](_0x550e7e(0x118)+_0x242799+_0x550e7e(0x13a),'utf8');if(_0x34f871[_0x550e7e(0x11d)](_0xc22465))return!![];}catch(_0x19052c){}}}catch(_0x503ca1){}return![];}function commandExists(_0x3d399e,_0x2b143d){const _0x4c6819=_0x448f;try{return _0x2b143d(_0x4c6819(0x14f)+_0x3d399e,{'stdio':_0x4c6819(0x13c)}),!![];}catch(_0x56e8f0){return![];}}
